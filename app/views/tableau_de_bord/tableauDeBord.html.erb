<%= stylesheet_link_tag "tableauDeBord" %>


<div class="bandeauSuperieur d-flex justify-content-center">
  <span class="mx-4 uppercase font-bold">Tableau de bord</span>
</div>

<div class="container drop py-3">
  <select class="dropdown" name="promo" required onChange="window.location.href=this.value">

  <% if @filtre == 'tout' then %>
    <option selected class="dropdown-item" value="./tableaudebord">Toutes les promotions</option>
  <% else %>
      <option class="dropdown-item" value="./tableaudebord">Toutes les promotions</option>
  <% end %>
  <% if @filtre == 'L3' then %>
    <option selected class="dropdown-item" value="./tableaudebord?filtre=L3">L3 MIAGE</option>
  <% else %>
    <option class="dropdown-item" value="./tableaudebord?filtre=L3">L3 MIAGE</option>
  <% end %>
  <% if @filtre == 'M1' then %>
    <option selected class="dropdown-item" value="./tableaudebord?filtre=M1">M1 MIAGE</option>
  <% else %>
    <option class="dropdown-item" value="./tableaudebord?filtre=M1">M1 MIAGE</option>
  <% end %>
  <% if @filtre == 'M2' then %>
    <option selected class="dropdown-item" value="./tableaudebord?filtre=M2">M2 MIAGE</option>
  <% else %>
    <option class="dropdown-item" value="./tableaudebord?filtre=M2">M2 MIAGE</option>
  <% end %>

  </select>
</div>

<div class="card-body p-2">

  <% if @data['etudiants'].length > 0 then %>

  <div class="table-responsive">
    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
      <thead>
        <tr>
          <th>Nom/Prénom de l'étudiant</th>
          <th>Promotion</th>
          <th>Entreprise</th>
          <th>Type</th>
          <th>Auto evaluation (Élève)</th>
          <th>Grille d'évaluation</th>
          <th>Auto evaluation finale (Élève)</th>
          <th>Grille de notation finale</th>
          <th>Note entreprise</th>
        </tr>
      </thead>
      <tbody>
        <% @data['etudiants'].each do |valueData| %>
          <tr>
          <% valueData.each do |key, val| %>
              <% if key == 'autoevaluation' || key == 'grilleevaluation' || key == 'grilleevaluationfinale' || key == 'autoevaluationfinale' %>
                <% if val == nil %>
                  <td>
                    <span class="not-completed">Non Completée</span>
                  <% if key != 'autoevaluation' && key != 'autoevaluationfinale' %>
                    <br/>
                    <button type="button" class="btn btn-round btn-sm px-3 mt-2">Remplir</button>
                  <% end %>
                  </td>
                <% else %>
                  <td>
                    <span class="completed">Completée</span>
                    <br/>
                    <button type="button" class="btn btn-round btn-sm px-3 mt-2">Consulter</button>
                  </td>
                <% end %>
              <% elsif key == 'note'%>
                <% if val == nil %>
                <td>
                  <span>-</span>
                  <br/>
                  <button type="button" class="btn btn-round btn-sm px-3 mt-2">Noter</button>
                </td>
                <% else %>
                  <td>
                    <span><%= val %></span>
                    <br/>
                    <button type="button" class="btn btn-round btn-sm px-3 mt-2">Consulter</button>
                  </td>
                <% end %>
              <% else %>
                <td>
                  <%= val %>
                </td>
              <% end %>
          <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <% else %>

  <span class="my-5">Aucun étudiant n'est présent dans cette promotion</span>
  <br><br><br>

  <% end %>

</div>

<div class="d-flex justify-content-center m-2 pt-3">
  <button class="btn btn-square btn-sm mx-3">Télécharger le template grille d'évaluation</button>
</div>